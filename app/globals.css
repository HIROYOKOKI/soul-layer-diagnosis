@import "tailwindcss";

/* ===== Tailwind v4 Theme Tokens ===== */
@theme {
  --color-brand: oklch(70% 0.22 260);
  --color-brand-600: oklch(63% 0.22 260);
  --color-brand-700: oklch(55% 0.22 260);
  --color-bg: oklch(14% 0.02 265);
  --color-surface: oklch(18% 0.02 265);
  --color-surface-2: oklch(22% 0.02 265);
  --color-fg: oklch(96% 0.01 265);
  --color-muted: oklch(75% 0.02 265);
  --color-on-brand: oklch(98% 0.01 265);
  --color-border: oklch(27% 0.02 265);
  --color-ring: var(--color-brand);
  --radius-card: 1rem;
  --radius-pill: 999px;
  --shadow-card: 0 10px 30px rgba(0,0,0,.35);
}

/* ===== Base Colors ===== */
:root { color-scheme: dark; }
body  { background: var(--color-bg); color: var(--color-fg); }

/* =========================
   Base（配色・タイポ・モバイル最適化）
   ========================= */
@layer base {
  :root {
    color-scheme: dark;

    /* 未来モード（青） */
    --bg: #000000;
    --fg: #ffffff;
    --panel: rgba(255,255,255,0.05);
    --border: rgba(255,255,255,0.10);

    --accent: #4fc3ff;
    --accent-shadow: 0 0 10px #4fc3ff, 0 0 20px #4fc3ff;
    --accent-shadow-strong: 0 0 20px #4fc3ff, 0 0 40px #4fc3ff;
    --accent-rgb: 79,195,255;

    /* EVΛƎ 構造別カラー（RGB） */
    --accent-e-rgb: 255,95,95;
    --accent-v-rgb: 79,195,255;
    --accent-l-rgb: 255,209,102;
    --accent-eps-rgb: 192,132,252;
  }

  /* 別テーマ例 */
  :root[data-mode="pink"] {
    --accent: #ff4fdf;
    --accent-shadow: 0 0 10px #ff4fdf, 0 0 20px #ff4fdf;
    --accent-shadow-strong: 0 0 20px #ff4fdf, 0 0 40px #ff4fdf;
    --accent-rgb: 255,79,223;
  }

  html {
    -webkit-text-size-adjust: 100%;
    scroll-behavior: smooth;
    height: 100%;
  }
  body {
    height: 100%;
    background: var(--bg);
    color: var(--fg);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ✅ レイアウト安定ガード（はみ出し抑止） */
  html, body { overflow-x: hidden; }
  *, *::before, *::after { box-sizing: border-box; min-width: 0; }

  a {
    color: inherit;
    text-decoration: none;
    -webkit-tap-highlight-color: transparent;
  }
  button, input, textarea, select {
    -webkit-appearance: none;
    appearance: none;
    background: none;
    border-radius: 0;
    color: inherit;
    font: inherit;
  }
  * { -webkit-touch-callout: none; }

  /* 画像/動画/キャンバスは親幅に収める */
  img, video, canvas, svg { max-width: 100%; height: auto; display: block; }

  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus,
  textarea:-webkit-autofill,
  select:-webkit-autofill {
    -webkit-text-fill-color: #fff;
    -webkit-box-shadow: 0 0 0px 1000px #0a0a0a inset;
    transition: background-color 9999s ease-in-out 0s;
  }
  ::-webkit-scrollbar { width:10px; height:10px; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,.12); border-radius:9999px; }
  ::-webkit-scrollbar-track { background: rgba(255,255,255,.04); }

  /* キーボード操作の視認性向上 */
  :focus-visible {
    outline: 2px solid rgb(var(--accent-rgb));
    outline-offset: 2px;
  }

  /* ✅ 中央ガイド（青い縦ライン）を完全無効化 */
  main::before,
  [data-center-guide]::before,
  .center-guide::before {
    content: none !important;
    display: none !important;
  }
  /* 念のため、縦1px罫線を透明化（誤適用対策） */
  .border-l, .border-l-[1px] { border-left-color: transparent !important; }
}

/* =========================
   Components（フォーム・ボタン）
   ========================= */
@layer components {
  /* ---- Ripple ---- */
  .ripple {
    position: absolute;
    border-radius: 9999px;
    pointer-events: none;
    width: 24px; height: 24px;
    transform: translate(-50%, -50%) scale(0);
    animation: ripple-bright 650ms ease-out forwards;
    mix-blend-mode: color-dodge;
    filter: drop-shadow(0 0 12px rgba(255,255,255,.35));
  }
  .ripple-accent {
    background: radial-gradient(closest-side,
      rgba(var(--accent-rgb), 0.85),
      rgba(var(--accent-rgb), 0.45) 40%,
      rgba(var(--accent-rgb), 0.12) 70%,
      transparent 100%);
  }
  .ripple-e   { background: radial-gradient(closest-side, rgba(var(--accent-e-rgb), 0.85),   rgba(var(--accent-e-rgb), 0.45) 40%,   rgba(var(--accent-e-rgb), 0.12) 70%,   transparent); }
  .ripple-v   { background: radial-gradient(closest-side, rgba(var(--accent-v-rgb), 0.85),   rgba(var(--accent-v-rgb), 0.45) 40%,   rgba(var(--accent-v-rgb), 0.12) 70%,   transparent); }
  .ripple-l   { background: radial-gradient(closest-side, rgba(var(--accent-l-rgb), 0.85),   rgba(var(--accent-l-rgb), 0.45) 40%,   rgba(var(--accent-l-rgb), 0.12) 70%,   transparent); }
  .ripple-eps { background: radial-gradient(closest-side, rgba(var(--accent-eps-rgb), 0.85), rgba(var(--accent-eps-rgb), 0.45) 40%, rgba(var(--accent-eps-rgb), 0.12) 70%, transparent); }

  .btn-pressable { transition: transform 120ms ease; }
  .btn-pressable:active { transform: scale(.985); }

  /* 押下時だけ外周グロー（構造別） */
  .btn-ripple[data-structure="E"]:active  { box-shadow: 0 0 30px rgba(var(--accent-e-rgb), .55); }
  .btn-ripple[data-structure="V"]:active  { box-shadow: 0 0 30px rgba(var(--accent-v-rgb), .55); }
  .btn-ripple[data-structure="Λ"]:active  { box-shadow: 0 0 30px rgba(var(--accent-l-rgb), .55); }
  .btn-ripple[data-structure="Ǝ"]:active  { box-shadow: 0 0 30px rgba(var(--accent-eps-rgb), .55); }

  /* ✅ 共通カード（はみ出し抑止＆視認性） */
  .evae-card {
    width: 100%;
    max-width: 100%;
    overflow: hidden;
    border-radius: 1rem; /* = var(--radius-card) */
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.03);
    box-shadow: 0 0 40px rgba(59,130,246,.08);
    padding: 1rem;
  }

  /* ✅ グラフ用ラッパ（幅100%固定） */
  .chart-wrap {
    width: 100%;
    min-width: 0;
    overflow: hidden;
    border-radius: .75rem;
  }
}

/* =========================
   Animations
   ========================= */
@keyframes ripple-bright {
  0%   { transform: translate(-50%, -50%) scale(0);   opacity: .95; }
  70%  { transform: translate(-50%, -50%) scale(5.2); opacity: .25; }
  100% { transform: translate(-50%, -50%) scale(6.2); opacity: 0;   }
}

@keyframes ripple {
  0%   { transform: translate(-50%, -50%) scale(0);   opacity: 0.7; }
  80%  { transform: translate(-50%, -50%) scale(4);   opacity: 0.15; }
  100% { transform: translate(-50%, -50%) scale(5.2); opacity: 0; }
}

/* 動きを最小化設定のユーザーには穏やかに */
@media (prefers-reduced-motion: reduce) {
  .btn-pressable, .ripple, .ripple-gradient {
    transition: none !important;
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
  }
}

/* ---- Fallback: 変数を :root に直置き（@theme失敗対策） ---- */
:root {
  --color-brand: oklch(70% 0.22 260);
  --color-brand-600: oklch(63% 0.22 260);
  --color-brand-700: oklch(55% 0.22 260);
  --color-bg: oklch(14% 0.02 265);
  --color-surface: oklch(18% 0.02 265);
  --color-surface-2: oklch(22% 0.02 265);
  --color-fg: oklch(96% 0.01 265);
  --color-muted: oklch(75% 0.02 265);
  --color-on-brand: oklch(98% 0.01 265);
  --color-border: oklch(27% 0.02 265);
  --color-ring: var(--color-brand);
  --radius-card: 1rem;
  --radius-pill: 999px;
  --shadow-card: 0 10px 30px rgba(0,0,0,.35);
}
/* ===== kill center guide (any leftover 'before' or gradient) ===== */
main::before,
.center-guide::before,
[data-center-guide]::before {
  content: none !important;
  display: none !important;
}

/* 背景グラデの“中央1px”系も全て無効化 */
.bg-center-line,
.has-center-line {
  background-image: none !important;
}

/* 念のため縦ボーダーを透明化（1px残り対策） */
.border-l,
.border-l-[1px] {
  border-left-color: transparent !important;
}
